[tox]
envlist = 
    # Python 3.8 - Minimum versions
    py38-matplotlib-min
    py38-seaborn-min
    py38-plotly-min
    py38-altair-min
    
    # Python 3.10 - Mid-range versions
    py310-matplotlib-latest
    py310-seaborn-latest
    py310-plotly-latest
    py310-altair-latest
    
    # Python 3.12 - Latest versions
    py312-matplotlib-latest
    py312-seaborn-latest
    py312-plotly-latest
    py312-altair-latest
    
    # Python 3.9 & 3.11 - All libraries
    py39-all
    py311-all
    
    # Quality checks
    lint
    visual
    
    # Full test suite
    full

skip_missing_interpreters = true

[testenv]
description = Run tests with specific Python and library versions
deps =
    pytest>=7.0.0
    pytest-cov>=4.0.0
    packaging>=23.0.0
    # Matplotlib versions
    matplotlib-min: matplotlib>=2.0.0,<3.0.0
    matplotlib-latest: matplotlib>=3.0.0
    # Seaborn versions
    seaborn-min: seaborn>=0.9.0,<0.11.0
    seaborn-latest: seaborn>=0.11.0
    # Plotly versions
    plotly-min: plotly>=4.0.0,<5.0.0
    plotly-latest: plotly>=5.0.0
    # Altair versions
    altair-min: altair>=3.0.0,<4.0.0
    altair-latest: altair>=4.0.0
    # All libraries
    all: matplotlib>=3.0.0
    all: seaborn>=0.11.0
    all: plotly>=5.0.0
    all: altair>=4.0.0
commands =
    pytest tests/ -v --cov=sane_figs --cov-report=term-missing --cov-report=html

[testenv:lint]
description = Run linting and type checking
basepython = python3.11
deps =
    black>=23.0.0
    ruff>=0.1.0
    mypy>=1.0.0
    packaging>=23.0.0
commands =
    black --check sane_figs tests
    ruff check sane_figs tests
    mypy sane_figs --ignore-missing-imports

[testenv:visual]
description = Run visual regression tests
basepython = python3.11
deps =
    pytest>=7.0.0
    pytest-regressions>=2.5.0
    matplotlib>=3.0.0
    seaborn>=0.11.0
    plotly>=5.0.0
    altair>=4.0.0
    packaging>=23.0.0
commands =
    pytest tests/visual/ --regression -v

[testenv:full]
description = Run all tests with all library versions
basepython = python3.11
deps =
    pytest>=7.0.0
    pytest-cov>=4.0.0
    pytest-regressions>=2.5.0
    matplotlib>=3.0.0
    seaborn>=0.11.0
    plotly>=5.0.0
    altair>=4.0.0
    packaging>=23.0.0
commands =
    pytest tests/ -v --cov=sane_figs --cov-report=term-missing --cov-report=html

[testenv:format]
description = Format code with black and ruff
basepython = python3.11
deps =
    black>=23.0.0
    ruff>=0.1.0
commands =
    black sane_figs tests
    ruff check --fix sane_figs tests

[testenv:docs]
description = Build documentation
basepython = python3.11
deps =
    sphinx>=7.0.0
    sphinx-rtd-theme>=2.0.0
    matplotlib>=3.0.0
    seaborn>=0.11.0
    plotly>=5.0.0
    altair>=4.0.0
commands =
    sphinx-build -b html docs docs/_build/html

[testenv:clean]
description = Clean up build artifacts
skip_install = true
deps =
commands =
    python -c "import shutil, pathlib; [shutil.rmtree(d) for d in pathlib.Path('.').rglob('*.egg-info') if d.is_dir()]"
    python -c "import shutil, pathlib; [shutil.rmtree(d) for d in pathlib.Path('.').rglob('__pycache__') if d.is_dir()]"
    python -c "import shutil, pathlib; [shutil.rmtree(d) for d in pathlib.Path('.').rglob('.pytest_cache') if d.is_dir()]"
    python -c "import shutil, pathlib; [shutil.rmtree(d) for d in pathlib.Path('.').rgexp('.tox') if d.is_dir()]"
    python -c "import shutil, pathlib; [shutil.rmtree(d) for d in pathlib.Path('.').rgexp('htmlcov') if d.is_dir()]"
    python -c "import shutil, pathlib; [shutil.rmtree(d) for d in pathlib.Path('.').rgexp('.coverage') if d.is_dir()]"
    python -c "import pathlib; [pathlib.Path(f).unlink() for f in pathlib.Path('.').rglob('.coverage.*') if pathlib.Path(f).is_file()]"

[testenv:report]
description = Generate coverage report
basepython = python3.11
deps =
    coverage>=7.0.0
skip_install = true
commands =
    coverage combine
    coverage report
    coverage html

[testenv:py{38,39,310,311,312}]
description = Run tests with all libraries on specific Python version
deps =
    pytest>=7.0.0
    pytest-cov>=4.0.0
    matplotlib>=3.0.0
    seaborn>=0.11.0
    plotly>=5.0.0
    altair>=4.0.0
    packaging>=23.0.0
commands =
    pytest tests/ -v --cov=sane_figs --cov-report=term-missing

[testenv:py{38,39,310,311,312}-matplotlib]
description = Run tests with matplotlib only
deps =
    pytest>=7.0.0
    pytest-cov>=4.0.0
    matplotlib>=2.0.0
    packaging>=23.0.0
commands =
    pytest tests/ -v -m "matplotlib" --cov=sane_figs --cov-report=term-missing

[testenv:py{38,39,310,311,312}-seaborn]
description = Run tests with seaborn only
deps =
    pytest>=7.0.0
    pytest-cov>=4.0.0
    seaborn>=0.9.0
    matplotlib>=2.0.0
    packaging>=23.0.0
commands =
    pytest tests/ -v -m "seaborn" --cov=sane_figs --cov-report=term-missing

[testenv:py{38,39,310,311,312}-plotly]
description = Run tests with plotly only
deps =
    pytest>=7.0.0
    pytest-cov>=4.0.0
    plotly>=4.0.0
    packaging>=23.0.0
commands =
    pytest tests/ -v -m "plotly" --cov=sane_figs --cov-report=term-missing

[testenv:py{38,39,310,311,312}-altair]
description = Run tests with altair only
deps =
    pytest>=7.0.0
    pytest-cov>=4.0.0
    altair>=3.0.0
    packaging>=23.0.0
commands =
    pytest tests/ -v -m "altair" --cov=sane_figs --cov-report=term-missing
